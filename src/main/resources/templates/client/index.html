<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="/css/libraries.css" />
  <link rel="stylesheet" href="/css/client/header.css" />
  <link rel="stylesheet" href="/css/client/index.css" />
  <link rel="stylesheet" href="/css/client/slide.css" />
  <link rel="stylesheet" href="/css/client/content.css" />
  <link rel="stylesheet" href="/css/client/count-down.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick-theme.css" />
  <link rel="stylesheet" href="/css/client/footer.css" />

</head>

<body>
  <div id="header"></div>

  <div id="movie-container">
    <div class="movie-container-background">
      <section class="hero">
        <div class="swiper-container">
          <div class="swiper-wrapper">

            <div class="swiper-slide">
              <img src="https://riotheatre.ca/wp-content/uploads/2016/04/matrix-banner-1-1024x576.jpg"
                alt="Clinic Image 1" />
              <div class="hero-text">
                <div class="hero-text-info">
                  <div class="hero-movie">
                    <div class="hero-movie-info">
                      <p class="hero-movie-name">
                        The Matrix
                      </p>
                      <p class="hero-movie-releasedDate">
                        2024-15-09
                      </p>
                    </div>
                    <div class="btn-banner">
                      <button class="hero-btn-buy-ticket">Mua vé</button>
                      <button class="hero-btn-movie-detail">
                        <span>Chi tiết</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="swiper-slide">
              <img
                src="https://static1.colliderimages.com/wordpress/wp-content/uploads/2021/07/avatar-sequel-what-we-know.jpg?q=50&fit=crop&w=1140&h=&dpr=1.5"
                alt="Clinic Image 1" />
              <div class="hero-text">
                <div class="hero-text-info">
                  <div class="hero-movie">
                    <div class="hero-movie-info">
                      <p class="hero-movie-name">
                        Avatar
                      </p>
                      <p class="hero-movie-releasedDate">
                        2024-15-09
                      </p>
                    </div>
                    <div class="btn-banner">
                      <button class="hero-btn-buy-ticket">Mua vé</button>
                      <button class="hero-btn-movie-detail">
                        <span>Chi tiết</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="swiper-slide">
              <img src="https://thedisinsider.com/wp-content/uploads/2023/03/Screen-Shot-2023-03-17-at-6.57.25-AM.png"
                alt="Clinic Image 1" />
              <div class="hero-text">
                <div class="hero-text-info">
                  <div class="hero-movie">
                    <div class="hero-movie-info">
                      <p class="hero-movie-name">
                        Siderman
                      </p>
                      <p class="hero-movie-releasedDate">
                        2024-15-09
                      </p>
                    </div>
                    <div class="btn-banner">
                      <button class="hero-btn-buy-ticket">Mua vé</button>
                      <button class="hero-btn-movie-detail">
                        <span>Chi tiết</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
        <div class="swiper-container-thumbs">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <img
                src="https://m.media-amazon.com/images/M/MV5BN2NmN2VhMTQtMDNiOS00NDlhLTliMjgtODE2ZTY0ODQyNDRhXkEyXkFqcGc@._V1_.jpg"
                alt="Thumb 1">
              <div class="thums-content">
                <div class="thums-trailer play-trailer" data-trailer-id="nSK8yjpO5F4">
                  <img src="https://cinestar.com.vn/assets/images/icon-play-vid.svg" alt="">
                  <span>Xem trailer</span>
                </div>
                <div class="btn-banner thums-btn">
                  <button class="hero-btn-buy-ticket">Mua vé</button>
                  <button class="hero-btn-movie-detail">
                    <span>Chi tiết</span>
                    <img src="/img/right-arrow.png" alt="xem chi tiet">
                  </button>
                </div>
              </div>
            </div>
            <div class="swiper-slide">
              <img src="https://upload.wikimedia.org/wikipedia/vi/b/b0/Avatar-Teaser-Poster.jpg" alt="Thumb 1">

              <div class="thums-content">
                <div class="thums-trailer play-trailer" data-trailer-id="nSK8yjpO5F4">
                  <img src="https://cinestar.com.vn/assets/images/icon-play-vid.svg" alt="">
                  <span>Xem trailer</span>
                </div>
                <div class="btn-banner thums-btn">
                  <button class="hero-btn-buy-ticket">Mua vé</button>
                  <button class="hero-btn-movie-detail">
                    <span>Chi tiết</span>
                    <img src="/img/right-arrow.png" alt="xem chi tiet">
                  </button>
                </div>
              </div>

            </div>
            <div class="swiper-slide">
              <img
                src="https://m.media-amazon.com/images/M/MV5BMmFiZGZjMmEtMTA0Ni00MzA2LTljMTYtZGI2MGJmZWYzZTQ2XkEyXkFqcGc@._V1_.jpg"
                alt="Thumb 1">

              <div class="thums-content">
                <div class="thums-trailer play-trailer" data-trailer-id="nSK8yjpO5F4">
                  <img src="https://cinestar.com.vn/assets/images/icon-play-vid.svg" alt="">
                  <span>Xem trailer</span>
                </div>
                <div class="btn-banner thums-btn">
                  <button class="hero-btn-buy-ticket">Mua vé</button>
                  <button class="hero-btn-movie-detail">
                    <span>Chi tiết</span>
                    <img src="/img/right-arrow.png" alt="xem chi tiet">
                  </button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="content-container">
      <div class="menu-movie">
        <div class="menu-movie-center">
          <ul class="menu-movie-list">
            <li id="movie-show-today"><a href="#movie-showing-now">Hôm nay</a></li>
            <li id="movie-top"><a href="#movie-trending">Top phim</a></li>
            <li id="movie-upcoming-show"><a href="#movie-showing">Sắp ra mắt</a></li>
            <li id="promotion"><a href="#promotion-show">Khuyến mãi</a></li>
          </ul>
          <div class="box-search">
            <div class="box-search-container">
              <input type="text" id="search-movie" placeholder="Tìm kiếm phim...">
              <i class="fas fa-search"></i>
              <ul id="suggestions-list" class="suggestions-list"></ul>
            </div>
          </div>
        </div>
      </div>
      <div class="list-movie-container">
        <div class="content-title" id="movie-showing-now">
          <p>Phim chiếu hôm nay</p>
        </div>
        <div class="content content-movie-show-to-day"></div>

        <div class="content-title" id="movie-showing">
          <p>Phim sắp ra mắt</p>
        </div>
        <div class="content content-movie-upcoming-show"></div>
      </div>

      <div class="list-movie-top-container">
        <div class="content-title" id="movie-trending">
          <p>Top 10 phim hót</p>
        </div>
        <div class="content-movie-hot">
          <div class="movie">

          </div>
          <div class="trailer">
            <div class="top-movie-trailer">
              <iframe id="top-movie-trailer" src="https://www.youtube.com/embed/lFxKzXW_64k" frameborder="3"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </div>
          </div>
        </div>
      </div>

      <div class="list-movie-container">
        <div class="content-title" id="promotion-show">
          <p>Khuyến mãi</p>
        </div>

        <div class="promotion">
          <img src="img/km-m-1.webp" alt="" />
          <img src="img/km-m-2.webp" alt="" />
          <img src="img/km-m-3.webp" alt="" />
          <img src="img/monday_1_.webp" alt="" />
        </div>
      </div>
    </div>
  </div>

  <div class="card-movie-search">
    <div class="card-search">
      <div class="card-search-image">
        <img id="image-movie-search" src="" alt="" />
        <div class="card-search-content">
          <p id="movie-name-search">Phim đô rê mon</p>
          <div class="card-search-info">
            <div class="movie-release-date"><i class="far fa-calendar-alt"></i><span
                id="movie-released-date-search">29.09.2024</span></div>
            <div class="movie-duration"><i class="far fa-clock"></i><span id="movie-duration-search">200 phút</span>
            </div>
            <div class="movie-rating"><i class="fa-regular fa-star"></i><span>5.0</span></div>
          </div>

          <div class="btn-movie">
            <button class="detail-movie btn-buy-ticket btn-buy-ticket-search">
              <i class="fas fa-ticket-alt"></i>
              <span>Mua vé</span>
            </button>
            <button class="detail-movie btn-detail-movie btn-detail-movie-search">
              <i class="fa-solid fa-circle-info"></i>
              <span>Chi tiết</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- <div class="content-card">
    <div class="title-card">
      <p style="font-size: 22px !important" id="movie-name-search"></p>
      <span class="show-full-name" id="show-full-name-search"></span>
    </div>
    <div class="date-card">
      <p style="font-size: 18px !important; margin-bottom: 0" id="movie-released-date-search"></p>
    </div>
  </div> -->
  <!-- <div class="btn-movie">
    <button class="detail-movie btn-buy-ticket btn-buy-ticket-search"><i class="fas fa-ticket-alt"></i>MUA
      VÉ</button>
    <button class="detail-movie btn-detail-movie btn-detail-movie-search">CHI TIẾT</button>
  </div>
  <div class="rating-container">
    <div class="triangle-container">
      <div class="movie-rating">
        <p class="number-rating" style="font-size: 15px">5.0</p>
      </div>
    </div>
  </div> -->

  <div class="count-down-container"></div>

  <div class="banner-movie-trailer">
    <span class="banner-close-trailer">&times;</span>
    <iframe id="banner-movie-trailer" src="" frameborder="3"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>
  </div>

  <div id="footer"></div>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/js/all.min.js"></script>
  <script src="/css/bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/client/slide.js"></script>
  <script src="/js/client/index.js"></script>
  <script src="/js/index.js"></script>
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel/slick/slick.min.js"></script>
  <!-- <script src="/js/resetLocalStorage.js"></script> -->
  <script>
    $(document).ready(function () {

      $('.promotion').slick({
        infinite: true,
        slidesToShow: 3,
        slidesToScroll: 3,
        autoplay: false,
        autoplaySpeed: 2000,
        arrows: false,
        dots: true,
        responsive: [
          {
            breakpoint: 489,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 2,
            },
          }
        ],
      });

      slick($(".content"), 5, 5);
      $('.count-down-container').load("/count-down", function () {
        $.getScript("js/client/count-down.js");
      });

      callApiGetMovie(
        "http://127.0.0.1:8000/api/movie/show-today",
        $(".content-movie-show-to-day")
      );
      callApiGetTop10Movie();
      callApiGetMovie(
        "http://127.0.0.1:8000/api/movie/upcoming",
        $(".content-movie-upcoming-show")
      );


      // $('#movie-show-today').addClass('active');
      // $('.list-movie-container').load("/movie/showing-today", function () {
      //   slick($(".content"), 5, 5);
      //   callApiGetMovie(
      //     "http://localhost:8080/api/pub/movie/showToDay",
      //     $(".content-movie-show-to-day")
      //   );
      // });

      // $(document).on('click', '#movie-top', function (e) {
      //   e.preventDefault();
      //   $('ul li').removeClass('active');
      //   $(this).addClass('active');
      //   $('.list-movie-container').load('/movie/movie-top-score', function () {
      //     slick($(".content"), 5, 5);
      //     callApiGetTop10Movie();
      //   });
      // });

      // $(document).on('click', '#movie-upcoming-show', function (e) {
      //   e.preventDefault();
      //   $('ul li').removeClass('active');
      //   $(this).addClass('active');
      //   $('.list-movie-container').load('/movie/movie-upcoming-show', function () {
      //     slick($(".content"), 5, 5);
      //     callApiGetMovie(
      //       "http://localhost:8080/api/pub/movie/upcomingReleases",
      //       $(".content-movie-upcoming-show")
      //     );
      //   });
      // });

      // $(document).on('click', '#movie-show-today', function (e) {
      //   e.preventDefault();
      //   $('ul li').removeClass('active');
      //   $(this).addClass('active');
      //   $('.list-movie-container').load('/movie/showing-today', function () {
      //     slick($(".content"), 5, 5);
      //     callApiGetMovie(
      //       "http://localhost:8080/api/pub/movie/showToDay",
      //       $(".content-movie-show-to-day")
      //     );
      //   });
      // });

      $('.menu-movie-list a').on('click', function (event) {
        if (this.hash !== "") {
          event.preventDefault();

          var hash = this.hash;

          $('html, body').animate({
            scrollTop: $(hash).offset().top - 170
          }, 0, function () {
            window.location.hash = hash;
          });

          $('.menu-movie-list li').removeClass('active');
          $(this).parent('li').addClass('active');
        }
      });

      $(document).on('click', '.play-trailer', function (e) {
        e.preventDefault();
        let trailerId = $(this).data("trailer-id");
        $('.banner-movie-trailer').show();
        $('#banner-movie-trailer').attr('src', 'https://www.youtube.com/embed/' + trailerId);
      });

      $(document).on('click', '.banner-close-trailer', function (e) {
        e.preventDefault();
        $('#banner-movie-trailer').attr('src', '');
        $('.banner-movie-trailer').hide();
      });

      $(document).on('click', '.card-movie-top', function () {
        $('.content-movie-hot .movie .card-movie-top').removeClass('active');
        const url = $(this).data('trailer-id');
        $('#top-movie-trailer').attr('src', 'https://www.youtube.com/embed/' + url);
        $(this).addClass('active');
      })
    });
  </script>
  <script>

    function slick(content, slideToShow, slideToScroll) {
      content.slick({
        infinite: true,
        slidesToShow: slideToShow,
        slidesToScroll: slideToScroll,
        autoplay: false,
        autoplaySpeed: 2000,
        arrows: false,
        dots: true,
        responsive: [
          {
            breakpoint: 2000,
            settings: {
              slidesToShow: 5,
              slidesToScroll: 5,
            },
          },
          {
            breakpoint: 1100,
            settings: {
              slidesToShow: 4,
              slidesToScroll: 4,
            },
          },
          {
            breakpoint: 700,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 3,
            },
          },
          {
            breakpoint: 489,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 2,
            },
          },
        ],
      });
    }

    function formatTime(milliseconds) {
      let totalSeconds = Math.floor(milliseconds / 1000);
      let minutes = Math.floor(totalSeconds / 60);
      let seconds = totalSeconds % 60;

      let formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      return formattedTime;
    }
    function callApiGetMovie(url, divParent) {
      let settings = {
        url: url,
        method: "GET",
        success: function (response) {
          divParent.empty();
          if (!response.data) {
            divParent.append(
              '<p style="max-width: 950px; text-align:center; margin-bottom: 50px;">Hiện tại không có phim nào!</p>'
            );
            return;
          }
          for (let movie of response.data) {
            renderMovie(movie, divParent);
          }
          $(".content").slick("unslick");
          slick($(".content"), 5, 5);
        },
        error: function (xhr) {
          let response = JSON.parse(xhr.responseText);
          console.log(response.message);
        },
      };
      $.ajax(settings);
    }

    function renderMovie(movie, divParent) {
      const releasedDate = formatDate(movie.release_date);
      const movieCard = `<div class="card-movie">
                    <div class="card-movie-image">
                        <img src="${BASE_URL + movie.poster_url}"
                             alt="${movie.movie_name}">
                        <div class="btn-movie">
                            <button class="detail-movie btn-buy-ticket" data-id="${movie.movie_id}"><i class="fas fa-ticket-alt"></i> <span>Mua vé</span></button>
                            <button class="detail-movie btn-detail-movie" data-id="${movie.movie_id}"><i class="fa-solid fa-circle-info"></i> <span>Chi tiết</span></button>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="rating-container">
                            <div class="movie-rating">
                              <i class="fas fa-star"></i>
                              <p class="number-rating">5.0</p>
                            </div>
                            <div class="date-card">
                              <p>${releasedDate}</p>
                            </div>
                        </div>
                        <div class="title-card">
                            <p>
                                ${movie.movie_name}
                            </p>
                        </div>
                        <div class="follow-movie">
                          <i class="fas fa-plus"></i>
                          Theo dõi
                        </div>
                    </div>
                </div>`;
      divParent.append(movieCard);

      applyAnimationClasses(divParent);
    }

    function applyAnimationClasses(divParent) {
      const cards = divParent.find('.card-movie');

      cards.each(function (index) {
        if (index === 0) {
          $(this).addClass('from-left');
        } else if (index === 4) {
          $(this).addClass('from-right');
        } else {
          $(this).addClass('from-bottom');
        }
        setTimeout(() => {
          $(this).addClass('show');
        }, 1000);
      });
    }

    function callApiGetTop10Movie() {
      let settings = {
        url: "http://localhost:8080/api/pub/movie/top-movie",
        method: "GET",
        success: function (response) {
          const div = $(".content-movie-hot .movie");

          let moviesToFetch = Object.entries(response).map(([id, score]) => ({
            id,
            score,
          }));

          let moviePromises = moviesToFetch.map(({ id, score }) => {
            return callApiGetMovieById(id, score);
          });

          Promise.all(moviePromises)
            .then((results) => {
              results.sort((a, b) => b.score - a.score);

              div.empty();
              results.forEach(({ movie, score }, index) => {
                renderMovieTop(movie, div, score, index);
              });
            })
            .catch((error) => {
              console.log("Error fetching movies:", error);
            });
        },
        error: function (xhr) {
          let response = JSON.parse(xhr.responseText);
          console.log(response.message);
        },
      };
      $.ajax(settings);
    }
    // Cập nhật hàm callApiGetMovieById để trả về Promise
    function callApiGetMovieById(id, score) {
      return new Promise((resolve, reject) => {
        var settings = {
          url: "http://localhost:8080/api/pub/movie/" + id,
          method: "GET",
          success: function (response) {
            resolve({ movie: response.data, score });
          },
          error: function (xhr) {
            var response = JSON.parse(xhr.responseText);
            console.log(response.message);
            reject(response.message);
          },
        };
        $.ajax(settings);
      });
    }

    function renderMovieTop(movie, divParent, score, index) {
      const date = formatDate(movie.releasedDate);
      const isActive = index === 0 ? 'active' : '';
      const movieCard = `
        <div class="card-movie-top ${isActive}" data-trailer-id="${movie.trailerUrl}">
            <div class="movie-rank"><span>${index + 1}</span></div>
            <div class="card-movie-image">
                <img src="${movie.imageSmallUrl}" alt="${movie.name}">
            </div>
            <div class="content-card">
                <div class="title-card">
                    <p>${movie.name}</p>
                </div>
                <div class="top-info">
                  <div class="movie-release-date"><i class="far fa-calendar-alt"></i> <span>${date}</span></div>
                  <div class="movie-duration"><i class="far fa-clock"></i> <span>${movie.duration} '</span></div>
                  <div class="movie-info">
                      <div class="movie-rating">
                          <i class="fa-regular fa-heart"></i>
                          <span>${score}</span>
                      </div>
                  </div>
                </div>
                <div class="btn-movie">
                  <button class="detail-movie btn-buy-ticket" data-id="${movie.id}">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Mua vé</span>
                  </button>
                  <button class="detail-movie btn-detail-movie" data-id="${movie.id}">
                    <i class="fa-solid fa-circle-info"></i>
                    <span>Chi tiết</span>
                  </button>
                </div>
            </div>
        </div>`;
      divParent.append(movieCard);

      if (index === 0) {
        $('#top-movie-trailer').attr('src', 'https://www.youtube.com/embed/' + movie.trailerUrl);
      }
    }

    //hàm định dạng ngày tháng năm theo kiểu DD-MM-YYYY
    function formatDate(dateString) {
      if (dateString == undefined) {
        return "";
      }
      let [year, month, day] = dateString.split('-');

      return `${day}.${month}.${year}`;
    }
  </script>
</body>

</html>